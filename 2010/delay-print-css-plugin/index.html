<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US" class="nojs nojswin"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title> Delay Print Stylesheets Plugin  |  Big Red Tin</title><link rel="alternate" type="application/atom+xml" title="Big Red Tin Feed" href="/feed/atom/" /><link rel="alternate" type="application/atom+xml" title="Big Red Tin Comments Feed" href="/comments/feed/atom/" /><link rel="pingback" href="/xmlrpc.php" /><script type="text/javascript">var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-11132236-2']);_gaq.push(['_setAllowAnchor',true],['_setCustomVar',1,'author','peter-wilson',3],['_setCustomVar',2,'tags','css javascript plugin wordpress',3],['_setCustomVar',3,'year','2010',3],['_trackPageview'],['_trackPageLoadTime']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();</script><link rel="alternate" type="application/rss+xml" title="Big Red Tin &raquo; Delay Print Stylesheets Plugin Comments Feed" href="/2010/delay-print-css-plugin/feed/" /><link rel='stylesheet' id='soup-allmedia-css'  href='/wp-content/themes/bigredtin/assets/child/c/all-media/all-media-min.css?ver=20110512.01' type='text/css' media='all' /> <!--[if IE 6]><link rel='stylesheet' id='soup-allmedia-ie6-css'  href='/wp-content/themes/bigredtin/assets/child/c/all-media/all-media-ie6-min.css?ver=20110512.01' type='text/css' media='all' /> <![endif]--> <!--[if IE 7]><link rel='stylesheet' id='soup-allmedia-ie7-css'  href='/wp-content/themes/bigredtin/assets/child/c/all-media/all-media-ie7-min.css?ver=20110512.01' type='text/css' media='all' /> <![endif]--><link rel='stylesheet' id='prettyPhoto-css-css'  href='/wp-content/themes/soup02/assets/parent/j/prettyPhoto_compressed_3.1.2/css/prettyPhoto.css?ver=3.1.2' type='text/css' media='screen, projection, handheld' /><link rel='stylesheet' id='contact-form-7-css'  href='/wp-content/plugins/contact-form-7/styles.css?ver=2.4.5' type='text/css' media='all' /><script type='text/javascript' src='/wp-includes/js/l10n.js?ver=20101110'></script><script type='text/javascript' src='/wp-includes/js/comment-reply.js?ver=20090102'></script><script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js'></script><link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" /><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /><link rel='index' title='Big Red Tin' href='/' /><link rel='start' title='Visual Editors are both good and bad' href='/2008/visual-editors-are-both-good-and-bad/' /><link rel='prev' title='An Answer to the Twitter Question' href='/2010/an-answer-to-the-twitter-question/' /><link rel='next' title='JavaScript Localisation in WordPress' href='/2010/javascript-localisation-in-wordpress/' /><link rel='shortlink' href='/?p=739' /><meta name="description" content="A few weeks ago I wrote a post in which I adapted an idea from a zOompf article to delay the loading of print stylesheets until after a web page has fully rendered. I've decided to convert the code from the original post into a plugin and add it to the WordPress plugin directory." /><meta name="keywords" content="css,javascript,plugin,wordpress" /><link rel="canonical" href="/2010/delay-print-css-plugin/" /> <script type="text/javascript">var _wpcf7={cached:1};</script><link rel="shortcut icon" type="image/x-icon" href="/wp-content/themes/bigredtin/assets/child/i/favicon.ico" /><link rel="icon" type="image/x-icon" href="/wp-content/themes/bigredtin/assets/child/i/favicon.ico" /><meta name="viewport" content="width=device-width, initial-scale=1.0"></head><body id="brt" class="nojs nojswin bxSngl bxAllBlog bxPost bxP-delay-print-css-plugin bxP-id739 bxPC-behind-the-websites bxPTag-css bxPTag-javascript bxPTag-plugin bxPTag-wordpress bxPA-peter"><div id="pageWrap" class="brt"><div id="header"><div id="siteDetails"><p id="siteName"><a href="http://bigredtin.com"><img src="/wp-content/themes/bigredtin/assets/child/i/logo-white-24.png" class="screen" width="323" height="90" alt="Big Red Tin  | Thoughts about the web and business from the large pantry" title="Big Red Tin | Thoughts about the web and business from the large pantry" /><img src="/wp-content/themes/bigredtin/assets/child/i/logo-colour-24.png" class="print" width="323" height="90" alt="" title="" /></a></p></div><div id="headerWidgets"></div></div><div id="container"><div id="navWrap" class="navWrap"></div><div id="content"><div id="contentHeadA" class="hentry p1 post publish post-delay-print-css-plugin author-peter-wilson cat-behind-the-websites tagged tag-css tag-javascript tag-plugin tag-wordpress"><div id="contentHead"><h1 class="entry-title" id="pageName"> <a href="/2010/delay-print-css-plugin/" title="Delay Print Stylesheets Plugin" rel="bookmark"> Delay Print Stylesheets Plugin </a></h1><p class="entry-date"><span class="published" title="2010-08-27T12:17:29+00:00">27 Aug '10</span></p></div><div id="contentA"><div class="entry-meta"><p class="details"> <span class="author vcard">By <a class="url fn n" href="/author/peter/" title="View all posts by Peter Wilson">Peter Wilson</a></span> <span class="cat-links"> in <a href="/category/behind-the-websites/" title="View all posts in Behind the Websites" rel="category tag">Behind the Websites</a></span></p><p class="comments-link"> <a href="/2010/delay-print-css-plugin/#comments">No responses</a></p></div><div class="entry-content"><p>A few weeks ago I wrote a post in which I <a title="adapted an idea from a zOompf article" href="/behind-the-websites/delay-loading-of-print-css/" >adapted an idea from a zOompf article</a> to delay the loading of print stylesheets until after a web page has fully rendered. I finished that post with the following point/question:</p><blockquote><p>Another question to ask is whether all this is actually worth the effort – even when reduced through automation. On Big Red Tin, the print.css is 595 bytes, the delay in rendering is negligible.</p></blockquote><p>Chris and Jeff at <a title="Digging into WordPress" href="http://digwp.com" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','digwp.com']);">Digging into WordPress</a> picked up the article and posted it on their site. In turn it was picked up elsewhere and became the surprise hit of the summer at Big Red Tin. Not bad when one is shivering through a bitter Melbourne winter.</p><p>As a result of the interest, I decided to convert the code from the original post into a plugin and add it to the WordPress plugin directory.</p><h4>Further Testing</h4><p>As I warned in the original article, I&#8217;d tested the code in very limited circumstances and found it had worked. Fine for a code sample but not enough for a sub version-1.0-release plugin. Additional testing showed:</p><ol><li>Stylesheets intended for IE, through conditional comments, were loading in all browsers</li><li>When loading multiple stylesheets, the correct order was not maintained in all browsers</li></ol><p>If jQuery was available I wanted to use it for JavaScript event management otherwise I&#8217;d use purpose-written JavaScript. There&#8217;s no point, after all, of worrying about the rendering delay caused by 600-1000 bytes only to load a 71KB (or 24KB <a title="gzipped" href="http://developer.yahoo.net/blog/archives/2007/07/high_performanc_3.html" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','developer.yahoo.net/blog/archives/2007/07/high_performanc_3.html']);">gzipped</a>) file in its place.</p><p>Other things I wanted to do included:</p><ol><li>Put the PHP in a class to reduce the risk of clashing function/class names</li><li>Put the JavaScript in its own namespace</li><li>Keep the output code as small as possible</li></ol><p>To support conditional comments for IE required adding each stylesheet within a separate &lt;script&gt; tag, using this method the output HTML takes the following form:</p><pre><code>&lt;script&gt;
  // add global print.css
&lt;/script&gt;
&lt;!--[if IE 6]&gt;
  &lt;script type='text/javascript'&gt;
    // add ie6 specific print.css
  &lt;/script&gt;
&lt;![endif]--&gt;</code></pre><p>This violates my aim to keep output as small as possible but footprint has to take second place to bug-free. I could have translated the code to use <a title="JavaScript conditional comments" href="http://en.wikipedia.org/wiki/Conditional_comment#Conditional_Comment_in_JScript" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','en.wikipedia.org/wiki/Conditional_comment#Conditional_Comment_in_JScript']);">JavaScript conditional comments</a> by translating the IE version to the JavaScript engine it uses but this could lead to future-proofing problems.</p><p>To maintain the order of stylesheets, I added each event to an array of functions and then used a single event to loop through the array of functions. If jQuery is used, I add multiple events because jQuery runs events on a first in first out basis.</p><p>Putting the PHP in a class and the JavaScript in its own namespace is fairly self-explanatory. <a href="http://bit.ly/bBUXCh" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','bit.ly/bBUXCh']);">Google is your friend</a> if you wish to read up further on this.</p><p>Minimising the footprint was also a simple step. I wrote the JavaScript out in full with friendly variable names. Once I was happy with the code, I ran the code through <a href="http://refresh-sf.com/yui/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','refresh-sf.com/yui/']);">the YUI JavaScript compressor</a>, commented out the original JavaScript in the plugin file and output the compressed version in its place.</p><p>The JavaScript is output inline (within the HTML) to avoid additional HTTP requests. I was in two minds about this because browser caching is lost in the process. So it may change in a later version.</p><p>I&#8217;ve worked out another way to keep the footprint small. Rather than creating a function to pass the stylesheet&#8217;s URL and ID to <code>brt_print.add(url, id)</code>, I wrote out the full function for each style sheet. I&#8217;ll fix that in the next release.</p><p>You can <a title="download" href="http://wordpress.org/extend/plugins/delay-print-css/download/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','wordpress.org/extend/plugins/delay-print-css/download/']);">download</a> the <a title="Delay Print CSS Plugin" href="http://http://wordpress.org/extend/plugins/delay-print-css/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://wordpress.org/extend/plugins/delay-print-css/']);">Delay Print CSS Plugin</a> from the WordPress plugin repository.</p></div><p class="tag-links entry-meta">Tagged: <a href="/tag/css/" rel="tag">CSS</a> &bull; <a href="/tag/javascript/" rel="tag">JavaScript</a> &bull; <a href="/tag/plugin/" rel="tag">plugin</a> &bull; <a href="/tag/wordpress/" rel="tag">WordPress</a></p><div id="authorDescription" class="author-description vcard"> <img alt='' src='http://1.gravatar.com/avatar/d6fa5fdcd09cd9484ebca5c0844cc13b?s=96&amp;d=http%3A%2F%2Fbigredtin.com%2Fwp-includes%2Fimages%2Fblank.gif&amp;r=G' class='avatar avatar-96 photo' height='96' width='96' /><h2>About<cite class="fn"> Peter Wilson</cite></h2><p>Peter Wilson is a Web Developer based in Melbourne, Australia. He co-founded Web Production firm <a href="http://soupgiant.com/" title="Soupgiant">Soupgiant</a> with Josh Kinal in October 2009.</p></div><div id="page-nav" class="page-nav nav"><div class="page-nav-older"><span class="direction">Previous post: </span><a href="/2010/an-answer-to-the-twitter-question/" rel="prev">An Answer to the Twitter Question</a></div><div class="page-nav-newer"><span class="direction">Next post: </span><a href="/2010/javascript-localisation-in-wordpress/" rel="next">JavaScript Localisation in WordPress</a></div></div><div id="comments"><div id="respond"><h2>Leave a Reply</h2><div id="cancel-comment-reply"><a rel="nofollow" id="cancel-comment-reply-link" href="/2010/delay-print-css-plugin/#respond" style="display:none;">Click here to cancel reply.</a></div><div class="formContainer"><form id="commentForm" action="/wp-comments-post.php" method="post"><p id="commentNotes">Your email is <em>never</em> shared.</p><div id="namePair" class="inputPair"> <label for="author">Name <span class="required">(required)</span></label> <input id="author" name="author" class="inputText inputReqd inputTextReqd" type="text" value="" size="30" maxlength="50" tabindex="3" /></div><div id="emailPair" class="inputPair"> <label for="email">Email <span class="required">(required)</span></label> <input id="email" name="email" class="inputText inputEmail inputReqd inputTextreqd inputEmailreqd" type="email" value="" size="30" maxlength="50" tabindex="4" /></div><div id="urlPair" class="inputPair"> <label for="url">Website</label> <input id="url" name="url" class="inputText" type="url" value="" size="30" maxlength="50" tabindex="5" /></div><div id="commentPair" class="inputPair"> <label for="comment">Comment <span class="required">(required)</span></label><textarea id="comment" name="comment" class="inputText inputReqd inputTextReqd" cols="45" rows="8" tabindex="6"></textarea></div><div class="submit"> <input id="submit" name="submit" class="button" type="submit" value="Post Your Comment" tabindex="7" /></div><div class="form-option"><input type='hidden' name='comment_post_ID' value='739' id='comment_post_ID' /> <input type='hidden' name='comment_parent' id='comment_parent' value='0' /></div></form></div></div></div></div></div></div><div id="contentC" class="sidebar"><div id="search-3" class="widget widget_search"><form method="get" action="http://bigredtin.com" class="search-form"><div> <label for="s-668911" class="search-label">Search this Site</label> <input type="text" name="s" id="s-668911" class="searchInput inputText" /> <input type="submit" value="Search" class="searchSubmit inputSubmit" /></div></form></div><div id="twitter-tools" class="widget aktt_widget"><h5 class="widget-title">Tasty Tweets</h5><div class="aktt_tweets"><ul><li>Quick Note: Taking the “distributed” out of CDN: Over on Twitter @<a href="http://twitter.com/bobearth" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','twitter.com/bobearth']);" class="aktt_username">bobearth</a> prompted me to do run some tra... <a href="http://redt.in/in7Fw8" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','redt.in/in7Fw8']);" rel="nofollow">http://redt.in/in7Fw8</a> ^auto <a href="http://twitter.com/bigredtin/statuses/77957604474761217" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','twitter.com/bigredtin/statuses/77957604474761217']);" class="aktt_tweet_time">16 hrs ago</a></li><li>Lovely. <a href="http://schema.org/" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','schema.org/']);" rel="nofollow">http://schema.org/</a> ^pw <a href="http://twitter.com/bigredtin/statuses/76439316313817088" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','twitter.com/bigredtin/statuses/76439316313817088']);" class="aktt_tweet_time">4 days ago</a></li><li>&quot;@wpmelbourne: WordPress [Melb meet] next Wed: <a href="http://bit.ly/is0PDa" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','bit.ly/is0PDa']);" rel="nofollow">http://bit.ly/is0PDa</a> Australian Ballet case study &amp; free pizza thanks to @<a href="http://twitter.com/envato" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','twitter.com/envato']);" class="aktt_username">envato</a>! #<a href="http://search.twitter.com/search?q=%23wpmelb" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','search.twitter.com/search?q=%23wpmelb']);" class="aktt_hashtag">wpmelb</a> quot; <a href="http://twitter.com/bigredtin/statuses/76145876912979968" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','twitter.com/bigredtin/statuses/76145876912979968']);" class="aktt_tweet_time">5 days ago</a></li><li class="aktt_more_updates"><a href="http://twitter.com/bigredtin">More updates...</a></li></ul></div></div><div id="text-4" class="widget widget_text"><h5 class="widget-title">B.R.T. by Soupgiant</h5><div class="textwidget"><p>Big Red Tin is presented by <a href="http://soupgiant.com" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','soupgiant.com']);"><strong>Soupgiant</strong></a>.</p><p>The philosophy is simple: <strong>Good content presented in the most efficient, user-friendly and accessible way possible</strong>.</p></div></div></div></div><div id="footer"><div id="footWidgets"><div id="recent-posts-3" class="foot-widget widget widget_recent_entries"><h5 class="widget-title">Recent Posts</h5><ul><li><a href="/2011/google-cdn-not-distributed/" title="Taking the &#8220;distributed&#8221; out of CDN">Taking the &#8220;distributed&#8221; out of CDN</a></li><li><a href="/2011/css-important-is-important/" title="!important is Important">!important is Important</a></li><li><a href="/2011/big-red-framework/" title="Big Red Framework">Big Red Framework</a></li><li><a href="/2011/guest-post-on-digwp/" title="Guest Post on Digging into WordPress">Guest Post on Digging into WordPress</a></li><li><a href="/2011/details-prevent-user-paralysis/" title="Details Prevent User Paralysis">Details Prevent User Paralysis</a></li></ul></div><div id="categories-3" class="foot-widget widget widget_categories"><h5 class="widget-title">Categories</h5><ul><li class="cat-item cat-item-557"><a href="/category/behind-the-websites/" title="Everything to do with website coding that we can think of. Front-end, back-end, upside and down, you&#039;ll find it here. It also contains our thoughts about Content Management Systems (CMS) and all the other little and technical things.">Behind the Websites</a></li><li class="cat-item cat-item-31"><a href="/category/business/" title="Producing websites is, in itself a business, but it often relates to the business of our clients. We&#039;ll try to put all of those thoughts and processes in here.">Business</a></li><li class="cat-item cat-item-540"><a href="/category/content-strategy/" title="Content whosawhatnow? When producing websites it&#039;s really important to think about what information you&#039;re going to provide, how it&#039;s going to be displayed and how is it going to affect your audience. That&#039;s content strategy in a nutshell. This is where we crack that nut.">Content Strategy</a></li><li class="cat-item cat-item-54"><a href="/category/design/" title="Design is so much more than just the graphics. A lot of thought goes in to how something looks, where elements are placed, what does and doesn&#039;t appear and when. You&#039;ll find that information here.">Design</a></li><li class="cat-item cat-item-4574"><a href="/category/quick-notes/" title="Just like it sounds. This is where we post clippings of interesting things we&#039;ve found (code, opinions, writings, pictures) that deal with all aspects of making the web. We found them interesting. You don&#039;t have to.">Quick Notes</a></li></ul></div><div id="linkcat-530" class="foot-widget widget widget_links"><h5 class="widget-title">Handy Links</h5><ul class='xoxo blogroll'><li><a href="/about/" rel="me" title="About Big Red Tin">About Big Red Tin</a></li><li><a href="http://twitter.com/bigredtin" rel="me" title="Follow Big Red Tin on Twitter" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://twitter.com/bigredtin']);">Follow us on Twitter</a></li><li><a href="/contact" rel="me" title="Get in Contact">Get in Contact</a></li><li><a href="http://feeds.soupgiant.com/bigredtin" rel="me" title="Subscribe to Big Red Tin in your feed reader" target="" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://feeds.soupgiant.com/bigredtin']);">Subscribe by RSS</a></li><li><a href="/plugins-themes/" rel="me">WordPress Plugins &amp; Themes</a></li></ul></div><div id="text-3" class="foot-widget widget widget_text"><h5 class="widget-title">Side Credits</h5><div class="textwidget"><ul><li class="copyright">Copyright &copy; 2009 - 2010 <a href="http://soupgiant.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','soupgiant.com/']);">Soupgiant</a></li><li class="credits credits-dev">Developed by <a href="http://soupgiant.com/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','soupgiant.com/']);">Soupgiant</a></li><li class="credits credits-design">Design by <a href="http://zepol.com.au/" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','zepol.com.au/']);">Zepol</a></li><li class="powered">Inevitably powered by <a href="http://wordpress.org" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','wordpress.org']);">WordPress</a></li></ul></div></div></div></div></div> <script type='text/javascript'>try{jQuery.noConflict();}catch(e){};</script><script type='text/javascript' src='/wp-content/themes/soup02/assets/parent/j/sg-base-min.js?ver=1.1.0'></script><script type='text/javascript' src='/wp-content/themes/soup02/assets/parent/j/prettyPhoto_compressed_3.1.2/js/jquery.prettyPhoto.js?ver=3.1.2'></script><script type='text/javascript' src='/wp-content/themes/bigredtin/assets/child/j/custom-min.js?ver=20110517.01'></script><script type='text/javascript' src='/wp-content/plugins/contact-form-7/jquery.form.js?ver=2.52'></script><script type='text/javascript' src='/wp-content/plugins/contact-form-7/scripts.js?ver=2.4.5'></script><script src="http://stats.wordpress.com/e-201123.js" type="text/javascript"></script><script type="text/javascript">st_go({blog:'13871010',v:'ext',post:'739'});var load_cmc=function(){linktracker_init(13871010,739,2);};if(typeof addLoadEvent!='undefined')addLoadEvent(load_cmc);else load_cmc();</script><!--[if IE 6]><script type='text/javascript' src='/wp-content/themes/soup02/assets/parent/j/ddbelatedpng-min.js'></script><script type="text/javascript">if(typeof jQuery=="function"){jQuery(window).ready(function(){DD_belatedPNG.fix('img');});}else{DD_belatedPNG.fix('img');}</script><![endif]--></body></html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Minified using disk
Page Caching using disk (enhanced)
Content Delivery Network via assets.sgiant.com/pressgiant

Served from: bigredtin.com @ 2011-06-08 06:51:02 -->